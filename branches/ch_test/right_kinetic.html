<!DOCTYPE HTML>
<html>
  <head>
    <link  rel="stylesheet" href="right_kinetic.css">  
  </head>
  <body>
    <div id="container"></div>
    <div id="container1"></div>
   	 <a id="save" href="#" class="myButton">Save as image</a>
    <a id="sendImg" href="#" class="myButton">Send an image to Email (not supported yet, just our idea.)</a><!-- not supported yet -->
    <a id="showSelected" href="#" class="myButton">Show selected items</a>
    <a id="hideSelected" href="#" class="myButton">Hide selected items</a>
    <div id="msgContainer"></div>
    
    <script src="kinetic-v4.3.1.js"></script> 
    <script src="common.js"> </script> 
    <script>
/////////////// Create Main structure from CSV file ///////////
createMainStructure("Theoph-from-R.csv");
//createMainStructure("ChickWeight-from-R.csv");

 ///////////////////////////////////////////////////////
 

//////////////////Common variables///////////////////////////
var idCounter = 0;
var plotWidth=500;
var plotHeight=500;
var plotXmargin=150;
var plotYmargin=90; 
var plotLength=15;
//////////variables for scatter chart//////////////// names are likely to change later
var radius_scale = 4; // / Dot radius in scatter chart 
var scatterX = 3;
var scatterY = 4;
var scatterXLabel = labelArr[scatterX];
var scatterYLabel = labelArr[scatterY];
var scatterXMain =  mainArr[scatterX];
var scatterYMain = mainArr[scatterY];

var scatterColor = mainArr[0];
var legend = true;

//var scatterColor = 'default';
//var legend = false;

var scatterXMax=findMaxValue(scatterXMain,0); //나중에 max함수 추가해서 5단위로 잡게 만들기.
var scatterYMax=findMaxValue(scatterYMain,0);
var scatterXDiff=parseInt(scatterXMax/5);//나중에 자동으로 잡아주기.
var scatterYDiff=parseInt(scatterYMax/6);
//////////variables for histogram chart//////////////// names are likely to change later
var histX = 3;
var histXLabel = labelArr[histX ];
var histXMain =  mainArr[histX ];

var diffHist = 2;
var histXMax=findMaxValue(histXMain,diffHist); //나중에 max함수 추가해서 5단위로 잡게 만들기.
var histYMax=histFindMaxValue(histXMax,histXMain,diffHist);
var histXDiff=parseInt(histXMax/5);//나중에 자동으로 잡아주기.
var histYDiff=parseInt(histYMax/5);   
    </script>     
    
    <script src="scatter_kinetic.js"></script>
    <script src="hist_kinetic.js"></script>
    
    <script>
    document.getElementById('save').addEventListener('click', function() {
        /*
         * since the stage toDataURL() method is asynchronous, we need
         * to provide a callback
         */
        stage.toDataURL({ //save stage
          callback: function(dataUrl) {
            /*
             * here you can do anything you like with the data url.
             * In this tutorial we'll just open the url with the browser
             * so that you can see the result as an image
             */
            window.open(dataUrl);
          }
        });
        stage1.toDataURL({ //save stage1
            callback: function(dataUrl1) {
              /*
               * here you can do anything you like with the data url.
               * In this tutorial we'll just open the url with the browser
               * so that you can see the result as an image
               */
              window.open(dataUrl1);
            }
          });
      }, false);    
    document.getElementById('showSelected').addEventListener('click', function() {
    	 msgShow = true;
      	 writeMsg(msgLayer);
      }, false);    
    
    document.getElementById('hideSelected').addEventListener('click', function() {
    	msgShow = false;
      	msgLayer.clear();
     }, false);    
    
    </script>
     <script>
    var msgStage = new Kinetic.Stage({
        container: 'msgContainer',
        width: 500,
        height: 500
      });      
    var msgLayer = new Kinetic.Layer();
    msgStage.add(msgLayer);
    function writeMsg(msgLayer){
    	var context = msgLayer.getContext();
    	msgLayer.clear();
    	
    	context.font = "12pt Calibri";
    	context.fillStyle = "black";	    
    	context.fillText("# of Selected for Hist", 300, 15);
    	var cnt=0;    	
    	for(var i=0; i<histData.length; i++){    		
    		context.font = "10pt Calibri";
    		context.fillText( i+' : '+histData[i].selected, 300, 13*cnt+30);
    		cnt++;    		
    	}
    	
    	context.font = "12pt Calibri";
        context.fillStyle = "black";	    
        context.fillText("Selected Items for Scatter", 10, 15);
       
        var cnt1=0;
        var cnt2=0;
       // document.write('a');
    	for(var i=0; i<scatterData.length; i++){
    		if(scatterData[i].selected==1){
    			if(cnt1>49){
    				cnt1=0;
    				cnt2=cnt2+20;
    			}
    			cnt1++;
    			context.font = "8pt Calibri";
    	//	    context.fillStyle = colors2[mainArr[0][i]-1];	
    			context.fillStyle = setColor(scatterColor,i);
    		    context.fillText(i, 10+cnt2, 10*cnt1+20);
    	//	document.write("selected("+i+") is : "+scatterData.selected[i]+"<br>");
    		}
    	}
    	
    }
    
    </script>
     
      
    
    <!-- <script src="hist_kinetic.js"></script> --!>
    
  </body>
</html>
